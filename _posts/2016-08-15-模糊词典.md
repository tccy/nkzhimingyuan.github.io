---
layout: post 
title: 模糊词典
---

#模糊词典
##相关脚本
全量`queryTransform.php
`

增量`generateIncrementDA.php`

时效性 `generateTimeFeatureDA.php`

##背景
1. query变换产生的模糊词典:aladdin_resource_attribute 特征词 同义词 如果特征词为空，取原始query并且吧并且把pm配置的中心词同义词也加上
2. 众挚广告双召回(无法解耦 ,和1耦合也太深了)
3. ms_attrword 人工配置的特征词,includ(地域扩展[裁掉地域词后的精确key],jgh上线的模糊词[待下线],) 
[背景wiki](http://wiki.baidu.com/display/KGAAL/AlaPlatformDevS119)

###原有逻辑
####全量
1. 取数据
2. 转码, 大小写可能合一，需要后续合并处理。
3. 加载预先生成的文件到内存中，去掉未上线资源。

####增量
1. 两个小时内配置query变换的的资源 特征词同义词
2. 众擎
3. 地域扩展特征词


####ms-attrword
#####mini模糊词典
* -rw-rw-r--  1 root root    12006 Jun  2 12:01 35.dict  @梦宇
[mis-link](http://mis.baidu.com:8080/stream/view?data_name=ps_android_alading_dict_psus.dict.txt)
同上  已经迁移
* -rw-rw-rw-  1 root root        5 Apr 11 12:16 6013.dict@houyinzhi @dongliqiang

* -rw-rw-r--  1 root root   324178 Apr 10 10:40 28050.dict 【28050】 【知道病例】   @yanxiaowei @jiawang
* -rw-rw-r--  1 root root    11229 Apr 10 10:32 6840.dict  @zhengkuan  无diff  已经停止更新 @jiawang
[mis-link](http://mis.baidu.com:8080/stream/view?data_name=ms_attrword_da)

##建表sql
###地域扩展词
<pre><code>CREATE TABLE `loc_ext_query` (
  `id` int(11) AUTO_INCREMENT  NOT NULL  COMMENT '主键id',
  `table_id` int(11) COLLATE utf8_bin NOT NULL COMMENT '资源id',
  `query` varchar(255) COLLATE utf8_bin NOT NULL COMMENT '资源id',
  PRIMARY KEY (`id`),
  UNIQUE KEY `idx_tid_query` (`table_id`,`query`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_bin COMMENT='地域扩展cache';</code></pre>
###配送
<pre><code>INSERT INTO `distribute_conf` ( `effective_module`, `conf_name`, `dist_type`, `lang`, `syn`, `conf_cn_name`, `distribute_service_id`, `pre_command_template`, `post_command_template`, `source_host`, `source_conf`, `target_path`, `is_backup`, `back_type`, `back_value`, `reg_time`, `alarm_mail`, `mobile_mail`, `state`) VALUES
( 'DA', 'feature_dict', 1, 'zh', 0, '模糊', 1, '', '', 'cq01-ps-aladdindfs2-1.cq01.baidu.com', '/home/work/platform/data/app/dictionary/feature/{dict_name}', '', 1, 2, 5, 1418714819, 'changchunjie', '', 0);</code></pre>

###CT
####all
<pre><code>
INSERT INTO `task_conf` VALUES ('','feature_all','cronjob',1,'','/home/work/platform/php/bin/stf_run /home/work/platform/app/dictionary/script/genFeatureDict.php -dict all','','changchunjie',0,'模糊全量词典',1,10,10000,'changchunjie','');
</pre></code>
####delta
<pre><code>
INSERT INTO `task_conf` VALUES ('','feature_delta','cronjob',1,'','/home/work/platform/php/bin/stf_run /home/work/platform/app/dictionary/script/genFeatureDict.php -dict delta','','changchunjie',0,'模糊增量词典',1,10,6000,'changchunjie','');
</pre></code>


##收益
###效果
* feature_all 14分钟
* feature delta 与2小时内的资源个数有关
* 地域扩展 1.7h 通过优化 降低至 1.3h 增加cache以后降低至7.3min
* 修复线上大量key不可用状态
 **eg. 30378**
 
 
